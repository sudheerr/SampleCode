// Generated by CoffeeScript 1.8.0
Ext.define('Corefw.view.grid.hierarch.HierarchyGridBase', {
  extend: 'Corefw.view.grid.GridBase',
  xtype: 'corehierarchygridbase',
  plugins: [
    {
      ptype: 'rowexpander',
      rowBodyTpl: '<div class="hierarchygrid-rowexpanded" ></div>',
      expandOnDblClick: false,
      selectRowOnExpand: false,
      expandOnEnter: false
    }
  ],
  initComponent: function() {
    var me;
    this.callParent(arguments);
    me = this;
    this.view.on('expandbody', function(rowNode, record, clickedRowDom, ev) {
      return me.expandOrCollapse(me, rowNode, record, clickedRowDom, ev);
    });
    this.view.on('collapsebody', function(rowNode, record, clickedRowDom, ev) {
      return me.expandOrCollapse(me, rowNode, record, clickedRowDom, ev);
    });
  },
  expandOrCollapse: function(comp, rowNode, record, clickedRowDom, ev) {
    var cache, colCache, columnAr, columnsCache, config, fieldCache, fieldProps, gridDataItems, newCache, newdiv, panel, props, uipath, _i, _len, _ref, _ref1;
    newdiv = Ext.dom.Query.selectNode('.hierarchygrid-rowexpanded', clickedRowDom);
    fieldCache = comp.up('corehierarchygrid').cache;
    gridDataItems = record != null ? (_ref = record.raw) != null ? (_ref1 = _ref._myProperties) != null ? _ref1.subGrid : void 0 : void 0 : void 0;
    if (!gridDataItems) {
      return;
    }
    if (!clickedRowDom.expanded) {
      clickedRowDom.expanded = true;
      cache = {};
      columnAr = [];
      fieldProps = fieldCache._myProperties;
      uipath = fieldProps.uipath + '/subGrid' + record.raw.__index;
      props = {
        uipath: uipath,
        parentGrid: comp,
        columnAr: columnAr,
        data: gridDataItems,
        newdiv: newdiv
      };
      cache._myProperties = props;
      Corefw.view.grid.ObjectGrid.createDataCache(gridDataItems, cache);
      columnsCache = fieldCache._myProperties.subContents;
      for (_i = 0, _len = columnsCache.length; _i < _len; _i++) {
        colCache = columnsCache[_i];
        newCache = {};
        newCache._myProperties = colCache;
        columnAr.push(colCache);
        cache[colCache.name] = newCache;
      }
      config = {
        cache: cache
      };
      panel = Ext.create('Corefw.view.grid.hierarch.HierarchyGridNode', config);
      panel.expandedRowIndex = record.index;
      clickedRowDom.panel = panel;
    } else {
      clickedRowDom.panel.destroy();
      delete clickedRowDom.panel;
      clickedRowDom.expanded = false;
    }
  }
});
