// Generated by CoffeeScript 1.8.0
Ext.define('Corefw.controller.Observation', {
  extend: 'Ext.app.Controller',
  init: function() {
    this.Observer = Corefw.util.Observer;
    return this.control({
      'corecompositeelement, coreelementform, coretoolbar': {
        afterrender: this.addObservedTarget
      },
      'coretoolbar[rendered] field': {
        change: this.markDirty
      },
      'coreelementform[rendered] field': {
        change: this.markDirty
      },
      'component[cache][uipath]': {
        afterrender: this.registerObserver
      }
    });
  },
  addObservedTarget: function(comp) {
    this.Observer.addTarget(comp.uipath);
  },
  registerObserver: function(comp) {
    var events, _ref;
    events = (_ref = comp.cache._myProperties) != null ? _ref.events : void 0;
    (Ext.isObject(events)) && (events = events._ar);
    events && this.Observer.registerObserver(comp.uipath, events);
  },
  markDirty: function(comp) {
    var parentKey, uip;
    uip = Corefw.util.Uipath;
    parentKey = uip.uipathToParentUipath(comp.uipath);
    this.Observer.updateState(this.Observer.States.DIRTY, parentKey);
  }
});
